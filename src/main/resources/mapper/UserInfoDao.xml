<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xinruiyun.platform.dao.UserInfoDao">
    <insert id="addUserInfo">
        insert into user_info(user_name,
            password,
            ua_name,
            user_jurisdiction,
            html,
            founder,
            create_time,
            renewing,
            update_time,
            callback_url,
            notify_url,
            state,
            remarks)
        values
            (#{user.userName},#{user.password},#{user.uaName},#{user.userJurisdiction},#{user.html},
            #{user.founder},#{user.createTime},#{user.renewing},#{user.updateTime},
            #{user.callbackUrl},#{user.notifyUrl},#{user.state},#{user.remarks})
    </insert>

    <update id="updateUserInfo">
        update user_info set
        user_name=#{user.userName},
        password=#{user.password},
        ua_name=#{user.uaName},
        user_jurisdiction=#{user.userJurisdiction},
        renewing=#{user.renewing},
        update_time=#{user.updateTime},
        callback_url=#{user.callbackUrl},
        notify_url=#{user.notifyUrl},
        state=#{user.state},
        remarks=#{user.remarks}
        where id = #{user.id}
    </update>

    <delete id="deleteUserById">
        delete from user_info where id=#{id}
    </delete>

    <delete id="deleteUserByUsername">
        delete from user_info where user_name=#{userName}
    </delete>

    <select id="queryAllUserInfo" resultType="com.xinruiyun.platform.entity.UserInfo">
        select * from user_info
    </select>

    <select id="queryUserByJurisdiction" resultType="com.xinruiyun.platform.entity.UserInfo">
        select * from user_info where user_jurisdiction=#{jurisdiction}
    </select>
    
    <select id="queryUserById" resultType="com.xinruiyun.platform.entity.UserInfo">
        select * from user_info where id=#{id}
    </select>
    
    <select id="queryUserByUsername" resultType="com.xinruiyun.platform.entity.UserInfo">
        select * from user_info where user_name=#{userName}
    </select>
    
    <update id="updatePassword">
         update user_info set password=#{password} where user_name=#{userName}
    </update>

    <update id="updateState">
        update user_info set state=#{state} where id=#{id}
    </update>

    <sql id="userObject">
        select id,user_name,password,ua_name,user_jurisdiction,html,founder,
         create_time,
         renewing,
         update_time,
         callback_url,
         notify_url,
         state,
         remarks
    </sql>

    <select id="queryUserByPage" resultType="com.xinruiyun.platform.entity.UserInfo">
        <include refid="userObject"/>
        from user_info
        <if test="pq.operator != null and pq.operator != ''">
            where founder=#{pq.operator}
        </if>
        order by create_time desc limit #{pq.pageIndex},#{pq.pageSize}
    </select>

    <select id="queryAllCount" resultType="Long">
        select count(*) from user_info
        <if test="founder != null and founder != ''">
            where founder=#{founder}
        </if>
    </select>
</mapper>